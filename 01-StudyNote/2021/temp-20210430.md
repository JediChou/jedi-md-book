# 智能运维从0搭建大规模分布式AIOps系统

* 微博广告每天会产生！ OTB 以上的增量数据，因为微博广告业务复杂，涉及的数据种类较多， 主要分为广告订单、广告受众、广告主、广告内容等主题。
  * Page 100
  * Jedi: 每家的因子不同，故而建模过程、建模结果也应不同。但建模的过程大致类似（套路相同）。

* kimball的建模？
  * Page 100
  * Jedi: 是什么玩意！

* 微博广告数据架构采用业内通用的Lambda 架构，实时计算和离线批处理计算同时运行。
  * Page 100
  * Lambda 架构
  * 离线批处理
  * Jedi: Lambda架构是第一次听说，完全不懂！
  * Jedi: 离线批处理的概念是理解的，但具体如何做呢？
  
* 业务存储、消息存储、离线存储、分析存储和应用存储
  * Page 101
  * Jedi: Kafaka这层很重要，显然需集群支持。
  * Jedi: 分析存储在富士康几乎是没有的！最多只能对应到报表服务器，并没有到自建引擎的地步。
  * Jedi: Clickhouse, Druid是啥子玩意？
  * Jedi: [Apache Druid](https://www.druid.apache.org/)
  * Jedi: [Clickhouse](https://clickhouse.tech/)
  
* 存储模型的设计借用的是业界通用的Kimball和Inmon模型。
  * Page 101
  * Jedi: 恕我孤陋寡闻～

### 5.4.2 数据仓库建模

#### Kimball

* 什么是维度模型（ Kimball)
  * Kimba ll 模型的设计流程是自底向上的，即从数据集市到数据仓库再到数据源（先有数据集市，后有数据仓库〉的一种敏捷开发方法
  * 数据流向正好相反

* Kimball模型流程
  * Target: Kimball 是以最终任务为导向的
  * 首先，从数据报表层得到数据需求，并确认目标。
  * 然后，尝试将数据按照目标先拆分出不同的表需求，再根据表需求，确认OLAP 上的数据立方体。
  * 接下来， 从OLAP 数据源中抽取出满足3范式的表。
  * 最后，从OLAP 立方体的角度出发，结合抽取出来的满足3范式的表，使用星型模型结构，设计出数据仓库，从而完成整个过程。

* Kimball建模: 选择业务过程 -> 声明粒度 -> 选定维度 -> 确定事实 -> 选择冗余维度（建议使用〉

#### Inmon

* 什么是E-R模型（Inmon)
  * 对于Inmon 模型，数据源往往是异构的。
  
* 模型流程
  * 首先， 需要探索性地从OLAP 数据源中获取尽量符合预期的数据，尝试将数据按照预期划分为不同的表需求。
  * 然后，将这些表划分成实体－关系模型，再在实体－关系模型的基础上细化主题表的数据项，满足3 范式，形成数据仓库。
  * 接下来，根据具体的需求，并考虑性能和平台的特点，进行合并或分区的设计。
  * 最后，形成OLAP 上的数据立方体，并输出到BI 系统中辅助具体业务。

#### 维度模型（ Kimball ）和E-R 模型Cinmon ）比较

* Kimbal (自底向上，以最终任务为导向)
  * 不支持关系表维护
  * 缓慢变化维
  * 开发难度小、交互快
  * 维度复杂
  * 适应特定业务，要快速看到效果
  * 数据冗余多
  * 业务直观，查询方便
  * 粒度僵硬，可复用性太低

* Inmon (自顶向下，以数据为导向)
  * 支持关系表维护
  * 连续变化维
  * 开发难度大，交互慢
  * 便于维护
  * 适应企业级，稳定业务
  * 数据冗余少
  * 结构清晰
  * join比较多

#### 建模实例

* Jedi: 建模实例写的很好！

### 5.4.3 常见的存储问题及解决方案

* 问题1 ：存储数据的安全问题
* 问题2 ：文件太多，存储不了
* 问题3 ：存储结构越来越混乱，三年后无法维护


## 第6章 大规模数据离线计算分析

## 6.1 经典的离线计算

### 6.1.1 Linux神级工具sed和awk

* sed 本质上是一个编辑器，但它是非交互式的，这一点与vim 不同；
* 同时它又是面向宇符流的，输入的字符流经过sed 的处理后输出。
